---
sort: 8
---

# Scion Backups Overview

This document describes an overview of the what, where, when, and how of 
backups on scion. It is meant for sysadmins (_de facto_ or otherwise).

For nitty-gritter detail, examine the working parts in `scion_admin` and read
the documentation in there.

# Terminology
The group of files generated by each day's backup is called a *backup set*
or simply a *set*. It's described more below.


# What
The backups on scion include our SVN repositories and Trac instances and
nothing else. Those repositories live in `/data/svn` and `/data/trac` 
respectively. The backup scripts (there's a script for SVN and a similar 
script for Trac) don't rely on a hardcoded list of repository/instance names. 
Instead, they scan the directories mentioned above for subdirectories that look 
like repositories/instances.

That means that if you add a new SVN repos, it will be backed up automatically.
Likewise, if you delete a repository (or a Trac instance), the backup scripts
don't need to be altered.


# Where
The backup files are dumped into `/data/backup` on scion. Another script
copies them to a remote machine (currently `spect5`), so we always have two
copies of our backups on different machines.

# When
The backups are run daily via a cron script (`cron.daily.sh`).

# How
I won't go into detail about the scripts themselves; they're pretty well 
commented. The basic idea is that we use the `trac-admin` command `hotcopy`
to get a live snapshot of the Trac instances and `svnadmin dump` for the
SVN repositories. The resulting files are compressed with bzip2.


# Filenames
Each backup filename contains three important pieces of information:
1. "svn" or "trac", which tells you if it is a backup of an SVN repos or a Trac
 instance.
1. The name of the repos or instance it represents
1. The timestamp from when the file was created, i.e. when the backup happened.
 We could probably rely on filesystem metadata for this, but I prefer this 
 explicit method.

For instance, consider this filename:

```
svn.sample_data.2012-04-19.04.05.51.dump.bz2
```

It tells you that it is an SVN backup of the sample_data repository taken on
19 April 2012 at about 5 minutes after 4AM. 

The timestamps serve a few purposes. For one, they allow us to determine which
files belong to a backup set. Every file created with a given date belongs to 
the same backup set.

Another nice property of the timestamps in the filenames is that they sort 
naturally. That is, the temporal ordering is the same as the alphabetic 
ordering.

# How to do a Manual Backup
The best way to do a manual backup is to manually run the scripts that would
ordinarily be run automatically. For instance, we currently do backups 
daily, and `cron.daily.sh` looks like this:

```
#!/bin/sh

/usr/bin/python /data/vespa/scion_admin/backup_cleanup.py local
/usr/bin/python /data/vespa/scion_admin/backup_svn.py
/usr/bin/python /data/vespa/scion_admin/backup_trac.py
/usr/bin/python /data/vespa/scion_admin/run_awstats.py
/data/vespa/scion_admin/remote_backup.sh
```

Steps 1, 2, 3, and 5 are the backup steps, so I'd just copy and paste them to
the command line.

If you want a copy of the latest backups, the script `grab_latest_backups.py` will do the trick.